---
title: "Group 9 Presentation"
author: "Henrique, Oriana, Jorie"
date: "12/4/2021"
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
options(repos='http://cran.rstudio.org')
have.packages <- installed.packages()
cran.packages <- c('devtools','plotrix','randomForest','tree')
to.install <- setdiff(cran.packages, have.packages[,1])
if(length(to.install)>0) install.packages(to.install)

library(devtools)
if(!('reprtree' %in% installed.packages())){
  install_github('araastat/reprtree')
}
for(p in c(cran.packages, 'reprtree')) eval(substitute(library(pkg), list(pkg=p)))
```

```{r, include=FALSE}


#reproducibility
set.seed(445)

library(ISLR)
library(leaps)
library(tidyr)
library(ggplot2)
library(glmnet)
library(caret)
library(pls) 
library(tree)
library(randomForest)
library(knitr)
library(class)
library(fastDummies)
library(reprtree)







train <- read.csv("train.csv")
test <- read.csv("test.csv")


train$ChestPainType <- as.factor(train$ChestPainType)
train$Sex <- as.factor(train$Sex)
train$FastingBS <- as.factor(train$FastingBS)
train$RestingECG <- as.factor(train$RestingECG)
train$ExerciseAngina <- as.factor(train$ExerciseAngina)
train$ST_Slope <- as.factor(train$ST_Slope)
train$HeartDisease <- as.factor(train$HeartDisease)


test$ChestPainType <- as.factor(test$ChestPainType)
test$Sex <- as.factor(test$Sex)
test$FastingBS <- as.factor(test$FastingBS)
test$RestingECG <- as.factor(test$RestingECG)
test$ExerciseAngina <- as.factor(test$ExerciseAngina)
test$ST_Slope <- as.factor(test$ST_Slope)
test$HeartDisease <- as.factor(test$HeartDisease)

```

## Group 9

Heart Disease
Oriana Meldrum, Henrique Rio, Jorie Alvis

## LDA

Jorie's LDA

## RF

Henrique's RF


```{r}
rf_fit <- randomForest(as.factor(HeartDisease) ~ ., data = train, mtry = sqrt(ncol(train)-1), importance = TRUE, type= "classification")

true <- test$HeartDisease
rf <- predict(rf_fit,test,type="class")

predicted2 <- ifelse(rf>0.5,1,0)

confm2<-table(predicted=rf,True=true)
kable(confm2)


paste("the overall fraction of correct predictions in the test dataset is :",(confm2[1,1]+confm2[2,2])/sum(confm2))

rf_fit
```


## Representative Tree
-Following the paper by  Banerjee, et al.(2011) and the package reprtree we can get a representative tree from the random forest.
-This tree is calculated using a measure of similarity in which 2 trees are similar if they have the same prediction for all observations.
-Using this idea on the random forest we get the following tree:

```{r}
reptree <- ReprTree(rf_fit, train, metric='d2')
plot(reptree, index=1)

```

## SVM

Jorie's SVM

## (the new thing)

Henrique's new thing insted of PCA

## Logistic Regression

Henrique's Logisic Regression



```{r}
model_glm = glm(HeartDisease ~ ., data = train, family = "binomial")
#summary(model_glm)


predicted2 <- predict(model_glm, newdata = test, "response")
predicted2 <- ifelse(predicted2>0.5,1,0)
confm2<-table(predicted=predicted2,True=test$HeartDisease)
kable(confm2)

paste("the overall fraction of correct predictions in the test dataset is :",(confm2[1,1]+confm2[2,2])/sum(confm2))



 #MSE

```

## Boosting

Jories's Boosting

## LASSO

Oriana's Lasso

```{r}

train_matrix <- model.matrix(HeartDisease ~ ., data = train)
test_matrix <- model.matrix(HeartDisease ~ ., data = test)
grid <- 10^seq(10, -2, length=100)

lasso <- glmnet(train_matrix, train$HeartDisease, alpha = 1, lambda = grid, thresh = 1e-12, family = "binomial")
#plot(lasso)



cv_lasso  <- cv.glmnet(train_matrix, train[, "HeartDisease"], alpha=1)
#plot(cv_lasso)
best_lambda_lasso <- cv_lasso$lambda.min

lasso_prediction <- predict(lasso, newx = test_matrix, s = best_lambda_lasso)
lasso_MSE <- mean((lasso_prediction - test[, "HeartDisease"])^2)

num_zeros <-cv_lasso$nzero[which.min(cv_lasso$cvm)]


# MSE values to use:
best_lambda_lasso
lasso_MSE
num_zeros



#Confusion Matrix
#predicted_lasso <- predict(lasso, newdata = test, "response")
#predicted_lasso <- ifelse(predicted_lasso>0.5,1,0)
#confm_lasso<-table(predicted=predicted_lasso,True=test$HeartDisease)
#confm_lasso


#Over all correct:
#overall_lasso <- (confm_lasso[1,1]+confm_lasso[2,2])/sum(confm_lasso)

#kable(confm_lasso) #confusion matrix
#overall_lasso #over all correct
```

## KNN

```{r}

temp_train <- dummy_cols(train, select_columns = c("Sex", "ChestPainType", "RestingECG", "ST_Slope", "ExerciseAngina") )
temp_test <- dummy_cols(test, select_columns = c("Sex", "ChestPainType", "RestingECG", "ST_Slope", "ExerciseAngina"))

drops <- c("Sex", "ChestPainType", "RestingECG", "ST_Slope", "ExerciseAngina")
temp_train <- temp_train[, !(names(temp_train) %in% drops)]
temp_test <-temp_test[, !(names(temp_test) %in% drops)]


#trainknn <- temp_train[-temp_train$HeartDisease]
#testknn <- test[-test$HeartDisease]


num_k <- seq(1:100)

my_cv <- knn.cv(temp_train, temp_train$HeartDisease, k=num_k)


knn_pred_1 <- knn(temp_train, temp_test, temp_train$HeartDisease, k=11)

confm_knn_1<-table(knn_pred_1,test$HeartDisease)

overall_knn_1 <- (confm_knn_1[1,1]+confm_knn_1[2,2])/sum(confm_knn_1)


overall_knn_1

 #confusion matrix
kable(confm_knn_1)
mean(knn_pred_1 !=test$HeartDisease)

```


## Bagging
```{r}

bagging <- randomForest(HeartDisease ~ .,data = train, mtry = 19, ntree = 500, type = "class", 
                        importance = TRUE,
                        proximity = TRUE) 
predict_bag <- predict(bagging, newdata = test)


#MSE
bagging_mse <- mean((predict_bag - test$HeartDisease)^2) 

#Confusion Matrix
predicted_bag <- predict(bagging, newdata = test)
predicted_bag <- ifelse(predicted_bag>0.5,1,0)
confm_bag<-table(predicted=predicted_bag,True=test$HeartDisease)
confm_bag


#Over all correct:
overall_bag <- (confm_bag[1,1]+confm_bag[2,2])/sum(confm_bag)

kable(confm_bag) #confusion matrix
overall_bag #over all correct

```


## Comparision of all method's MSE

Chart with all MSE

```{r}
library(knitr)
df1 = data.frame(Method = c('LDA', 'RF', 'SVM', 'new THING', 'Logistic Regression', 'Boosting', 'LASSO', 'PLS', 'Bagging'),  MSE = c(0,0,0,0,0.1498638,0,0,0.1054 ,0.1165492))

kable(df1)

```

## Conclusion

the METHOD worked best, with an MSE of SOMETHING

```{r pressure}
plot(pressure)
```

